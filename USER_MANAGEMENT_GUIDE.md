# คู่มือการใช้งานระบบจัดการผู้ใช้

## ระบบสร้างผู้ใช้ใหม่พร้อมลิงก์ตั้งรหัสผ่าน

### ฟีเจอร์ใหม่ที่เพิ่มเข้ามา

1. **สร้างผู้ใช้ใหม่** - Admin สามารถสร้างผู้ใช้ใหม่ได้จากหน้า Admin Panel
2. **ลิงก์ตั้งรหัสผ่าน** - ระบบจะสร้างลิงก์สำหรับตั้งรหัสผ่านและแสดงให้ admin
3. **หน้าตั้งรหัสผ่าน** - ผู้ใช้สามารถตั้งรหัสผ่านใหม่ได้ผ่านลิงก์ที่ได้รับ

### ขั้นตอนการใช้งาน

#### สำหรับ Admin:

1. **เข้าสู่ระบบ** ด้วยบัญชี admin
2. **ไปที่หน้า Admin Panel** (คลิกไอคอนเฟืองที่ header)
3. **คลิกปุ่ม "เพิ่มผู้ใช้"** ที่มุมขวาบน
4. **กรอกข้อมูลผู้ใช้:**
   - ชื่อ
   - อีเมล
   - สิทธิ์ (admin, juristic, technician, owner, user)
   - สถานะ (ใช้งานได้/ไม่ใช้งาน)
5. **คลิก "บันทึก"**
6. **ระบบจะแสดงลิงก์ตั้งรหัสผ่าน** ให้ admin คัดลอกและส่งไปให้ผู้ใช้

#### สำหรับผู้ใช้ใหม่:

1. **รับลิงก์ตั้งรหัสผ่าน** จาก admin
2. **คลิกลิงก์** เพื่อไปยังหน้าตั้งรหัสผ่าน
3. **กรอกรหัสผ่านใหม่** (อย่างน้อย 6 ตัวอักษร)
4. **ยืนยันรหัสผ่าน**
5. **คลิก "ตั้งรหัสผ่านใหม่"**
6. **ระบบจะ redirect ไปหน้า login** ให้เข้าสู่ระบบด้วยรหัสผ่านใหม่

### ไฟล์ที่เกี่ยวข้อง

- `pages/admin-users.tsx` - หน้า Admin Panel สำหรับจัดการผู้ใช้
- `pages/api/create-user.ts` - API endpoint สำหรับสร้างผู้ใช้
- `pages/reset-password.tsx` - หน้าตั้งรหัสผ่านใหม่
- `FIREBASE_SETUP.md` - คู่มือการตั้งค่า Firebase Admin SDK

### การตั้งค่าที่จำเป็น

1. **Firebase Admin SDK** - ต้องตั้งค่าตาม `FIREBASE_SETUP.md`
2. **Environment Variables** - ต้องมีไฟล์ `.env.local` พร้อมข้อมูล Firebase
3. **Firebase Authentication** - ต้องเปิดใช้งาน Email/Password authentication

### หมายเหตุสำคัญ

- **ลิงก์ตั้งรหัสผ่านจะหมดอายุใน 1 ชั่วโมง**
- **ระบบจะสร้างรหัสผ่านชั่วคราวให้ผู้ใช้ใหม่**
- **ผู้ใช้ต้องตั้งรหัสผ่านใหม่ก่อนเข้าสู่ระบบได้**
- **Admin สามารถคัดลอกลิงก์และส่งให้ผู้ใช้ได้**

### การแก้ไขปัญหา

#### ปัญหาที่อาจเกิดขึ้น:

1. **"ลิงก์ไม่ถูกต้องหรือหมดอายุ"**
   - ลิงก์หมดอายุแล้ว (เกิน 1 ชั่วโมง)
   - ลิงก์ถูกใช้ไปแล้ว
   - ลิงก์ไม่ถูกต้อง

2. **"อีเมลนี้มีผู้ใช้งานแล้ว"**
   - อีเมลนี้ถูกใช้ไปแล้วในระบบ
   - ต้องใช้อีเมลอื่น

3. **"เกิดข้อผิดพลาดในการเชื่อมต่อ"**
   - ตรวจสอบการตั้งค่า Firebase Admin SDK
   - ตรวจสอบ environment variables

### การพัฒนาต่อ

ในอนาคตสามารถเพิ่มฟีเจอร์:
- ส่งอีเมลอัตโนมัติแทนการแสดงลิงก์
- ระบบแจ้งเตือนเมื่อลิงก์หมดอายุ
- ประวัติการสร้างผู้ใช้
- การจัดการสิทธิ์แบบละเอียด 