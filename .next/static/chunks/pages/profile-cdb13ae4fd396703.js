(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{3611:(e,a,t)=>{"use strict";t.d(a,{db:()=>m,j:()=>d});var r=t(6042),i=t(9917),l=t(2964),n=t(5226),s=t(5364);let o={apiKey:s.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyDtZQ_gX9xWqGQgxQMBzTH8c9o6t-ZsvKc",authDomain:s.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"raoteebaan.firebaseapp.com",databaseURL:s.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL||"https://raoteebaan-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:s.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"raoteebaan",storageBucket:s.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"raoteebaan.appspot.com",messagingSenderId:s.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"986271509277",appId:s.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:986271509277:web:ff35142f2eabe2063c0ff4",measurementId:s.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-YW7ZP3B4TC"},c=(0,r.Dk)().length?(0,r.Dk)()[0]:(0,r.Wp)(o),d=(0,i.xI)(c),m=(0,l.aU)(c);(0,n.c7)(c)},4850:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>y});var r=t(7876),i=t(5377),l=t(9803),n=t(9955),s=t(485),o=t(3782),c=t(2736),d=t(1921),m=t(7523),u=t(1362),h=t(3869),x=t(6676),f=t(6491),p=t(5812),E=t(4747),j=t(9099),v=t(4232),b=t(3611),g=t(2870),_=t(9917),S=t(2964);function y(){let e=(0,j.useRouter)(),a=(0,i.d)(),[t,y]=(0,v.useState)(null),[I,R]=(0,v.useState)(!1),[w,B]=(0,v.useState)({name:"",email:"",avatar:""}),T=(0,v.useRef)(null),[U,A]=(0,v.useState)(""),[C,N]=(0,v.useState)(!1),[D,F]=(0,v.useState)(null);(0,v.useEffect)(()=>{let a=b.j.currentUser;if(a){let e=(0,S.aQ)((0,S.H9)(b.db,"users",a.uid),e=>{var t,r,i,l;let n=e.exists()?e.data():{};y({name:n.name||a.displayName||"-",email:n.email||a.email||"-",avatar:n.avatar||a.photoURL||"",started:(null==(r=a.metadata)||null==(t=r.creationTime)?void 0:t.split("T")[0])||"-",lastActive:(null==(l=a.metadata)||null==(i=l.lastSignInTime)?void 0:i.split("T")[0])||"-",status:n.status||(a.emailVerified?"active":"inactive"),role:n.role||("admin@example.com"===a.email?"admin":"user")}),B({name:n.name||a.displayName||"",email:n.email||a.email||"",avatar:n.avatar||a.photoURL||""}),A(n.avatar||a.photoURL||"")});return()=>e()}y(null),B({name:"",email:"",avatar:""}),A(""),e.replace("/login")},[]);let L=e=>{B(a=>({...a,[e.target.name]:e.target.value}))};async function k(e){let a=new FormData;a.append("file",e);let t=await fetch("https://discord.com/api/webhooks/1388606701053149347/tbJBU84BK2qXGBnuO1fVm7u1LsKrudEKOI_rS9HVwsy9JhlZpx7LwNXpA2TfJDh38pGI",{method:"POST",body:a});if(!t.ok)throw Error("อัปโหลดไป Discord ไม่สำเร็จ");let r=await t.json();if(r.attachments&&r.attachments[0]&&r.attachments[0].url)return r.attachments[0].url;throw Error("ไม่พบลิงก์รูปใน response ของ Discord")}let z=async()=>{if(b.j.currentUser){N(!0);try{let r=t.avatar;if(D){if(!D.type.startsWith("image/")){a({title:"กรุณาเลือกไฟล์รูปภาพเท่านั้น",status:"warning"}),N(!1);return}if(D.size>5242880){a({title:"ไฟล์ใหญ่เกินไป กรุณาเลือกรูปที่มีขนาดไม่เกิน 5MB",status:"warning"}),N(!1);return}r=await k(D)}(w.name!==t.name||r!==t.avatar)&&await (0,_.r7)(b.j.currentUser,{displayName:w.name,photoURL:r||void 0}),w.email!==t.email&&await (0,_.Ww)(b.j.currentUser,w.email),await (0,S.BN)((0,S.H9)(b.db,"users",b.j.currentUser.uid),{name:w.name,email:w.email,avatar:r,status:t.status,role:t.role,updatedAt:new Date},{merge:!0}),a({title:"บันทึกโปรไฟล์สำเร็จ",status:"success"}),R(!1),F(null),e.replace(e.pathname)}catch(e){console.error("Error saving profile:",e),a({title:"เกิดข้อผิดพลาด",description:e.message||"ไม่สามารถบันทึกโปรไฟล์ได้",status:"error"})}finally{N(!1)}}},P=async()=>{try{await (0,_.CI)(b.j),e.push("/login")}catch(e){a({title:"ออกจากระบบไม่สำเร็จ",status:"error"})}};return t?(0,r.jsx)(l.s,{minH:"100vh",align:"center",justify:"center",bgGradient:"linear(to-br, #e3f2fd, #bbdefb)",children:(0,r.jsxs)(n.a,{bg:"white",borderRadius:"2xl",boxShadow:"2xl",p:[4,8],maxW:"400px",w:"full",position:"relative",children:[(0,r.jsx)(s.K,{icon:(0,r.jsx)(g.QVr,{}),"aria-label":"ย้อนกลับ",position:"absolute",top:4,left:4,colorScheme:"blue",variant:"ghost",borderRadius:"full",onClick:()=>e.back()}),(0,r.jsxs)(l.s,{direction:"column",align:"center",mb:6,mt:2,children:[(0,r.jsx)(o.e,{size:"2xl",name:w.name||t.name,src:U||t.avatar,mb:4}),(0,r.jsx)(c.D,{fontSize:"2xl",color:"blue.700",mb:1,children:"โปรไฟล์ผู้ใช้งาน"}),(0,r.jsx)(d.E,{color:"gray.500",children:"ข้อมูลบัญชีของคุณ"}),(0,r.jsx)(m.E,{colorScheme:"admin"===t.role?"purple":"blue",borderRadius:"full",px:3,py:1,fontSize:"sm",mt:2,children:"admin"===t.role?"ผู้ดูแลระบบ":"ผู้ใช้งานทั่วไป"})]}),(0,r.jsxs)(u.T,{align:"stretch",spacing:3,mb:6,children:[(0,r.jsxs)(h.MJ,{children:[(0,r.jsx)(x.l,{children:"ชื่อผู้ใช้"}),I?(0,r.jsx)(f.p,{name:"name",value:w.name,onChange:L}):(0,r.jsx)(d.E,{fontWeight:"bold",color:"gray.800",children:t.name})]}),(0,r.jsxs)(h.MJ,{children:[(0,r.jsx)(x.l,{children:"อีเมล"}),I?(0,r.jsx)(f.p,{name:"email",value:w.email,onChange:L}):(0,r.jsx)(d.E,{color:"gray.800",children:t.email})]}),(0,r.jsxs)(h.MJ,{children:[(0,r.jsx)(x.l,{children:"รูปโปรไฟล์"}),I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.$,{size:"md",onClick:()=>{var e;return null==(e=T.current)?void 0:e.click()},mb:2,borderRadius:"xl",fontFamily:"Kanit",children:"อัปโหลดรูปใหม่"}),(0,r.jsx)("input",{type:"file",accept:"image/*",ref:T,style:{display:"none"},onChange:e=>{let t=e.target.files[0];if(t){if(t.size>5242880)return void a({title:"ไฟล์ใหญ่เกินไป กรุณาเลือกรูปที่มีขนาดไม่เกิน 5MB",status:"warning"});if(!t.type.startsWith("image/"))return void a({title:"กรุณาเลือกไฟล์รูปภาพเท่านั้น",status:"warning"});F(t);let e=new FileReader;e.onload=e=>{var a;A(null==(a=e.target)?void 0:a.result)},e.readAsDataURL(t)}}}),D&&(0,r.jsxs)(d.E,{fontSize:"sm",color:"gray.600",children:["ไฟล์ที่เลือก: ",D.name]})]}):null]}),(0,r.jsxs)(n.a,{children:[(0,r.jsx)(d.E,{color:"gray.600",fontSize:"sm",children:"สถานะ"}),(0,r.jsx)(m.E,{colorScheme:"active"===t.status?"green":"gray",borderRadius:"full",px:3,py:1,fontSize:"sm",children:"active"===t.status?"ใช้งานอยู่":"ไม่ใช้งาน"})]}),(0,r.jsxs)(n.a,{children:[(0,r.jsx)(d.E,{color:"gray.600",fontSize:"sm",children:"วันที่เริ่มใช้งาน"}),(0,r.jsx)(d.E,{color:"gray.800",children:t.started})]}),(0,r.jsxs)(n.a,{children:[(0,r.jsx)(d.E,{color:"gray.600",fontSize:"sm",children:"ใช้งานล่าสุด"}),(0,r.jsx)(d.E,{color:"gray.800",children:t.lastActive})]})]}),(0,r.jsx)(E.c,{mb:6}),(0,r.jsx)(l.s,{gap:3,children:I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.$,{colorScheme:"blue",flex:1,onClick:z,isLoading:C,borderRadius:"xl",fontFamily:"Kanit",size:"md",children:"บันทึก"}),(0,r.jsx)(p.$,{flex:1,variant:"outline",onClick:()=>{R(!1),B({name:t.name,email:t.email,avatar:t.avatar}),A(t.avatar),F(null)},borderRadius:"xl",fontFamily:"Kanit",size:"md",children:"ยกเลิก"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.$,{colorScheme:"blue",flex:1,onClick:()=>R(!0),borderRadius:"xl",fontFamily:"Kanit",size:"md",children:"แก้ไขโปรไฟล์"}),(0,r.jsx)(p.$,{colorScheme:"red",flex:1,variant:"outline",onClick:P,borderRadius:"xl",fontFamily:"Kanit",size:"md",children:"ออกจากระบบ"})]})})]})}):null}},8172:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return t(4850)}])}},e=>{var a=a=>e(e.s=a);e.O(0,[671,871,465,190,636,593,792],()=>a(8172)),_N_E=e.O()}]);