(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[281],{3494:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>A});var l=t(7876),a=t(9099),i=t(4232),n=t(5377),s=t(6305),o=t(9955),d=t(9803),c=t(5812),x=t(2736),h=t(1921),g=t(8387),u=t(6491),b=t(9749),m=t(2056),j=t(9407),p=t(3973),f=t(2665),y=t(5791),v=t(3043),S=t(4435),E=t(2445),_=t(2426),T=t(7961),w=t(6078),R=t(4275),I=t(2870),z=t(8619),C=t(3611),N=t(2964);function A(){var e;let r=(0,a.useRouter)(),{roomId:t}=r.query,[A,D]=(0,i.useState)({date:"",dueDate:"",meter:"",prev:"",unit:"",total:"",rate:"0"}),[B,W]=(0,i.useState)({meter:"",prev:"",unit:"",total:"",rate:"0"}),[F,M]=(0,i.useState)([]),[P,k]=(0,i.useState)(null),U=(0,n.d)();(0,s.A)({base:!0,md:!1});let[L,H]=(0,i.useState)(null),G=(0,i.useRef)(null);(0,i.useEffect)(()=>{t&&(async()=>{try{let e=await (0,N.x7)((0,N.H9)(C.db,"rooms",String(t)));if(e.exists()){let r=e.data();k(r)}}catch(e){console.error("Error fetching room data:",e)}})()},[t]),(0,i.useEffect)(()=>{t&&(async()=>{let e=(0,N.P)((0,N.rJ)(C.db,"bills"),(0,N._M)("roomId","==",String(t)),(0,N.My)("createdAt","desc"));M((await (0,N.GG)(e)).docs.map(e=>({id:e.id,...e.data()})))})()},[t]),(0,i.useEffect)(()=>{F.length>0?(D(e=>({...e,prev:String(F[0].electricityMeterCurrent||0)})),W(e=>({...e,prev:String(F[0].waterMeterCurrent||0)}))):(D(e=>({...e,prev:"0"})),W(e=>({...e,prev:"0"})))},[F]),(0,i.useEffect)(()=>{F.length>0?(D(e=>({...e,rate:String(F[0].electricityRate||4.5)})),W(e=>({...e,rate:String(F[0].waterRate||15.5)}))):(D(e=>({...e,rate:"4.5"})),W(e=>({...e,rate:"15.5"})))},[F]);let X=async()=>{if(t){if(!A.date||!A.dueDate||!A.meter||!A.rate||!B.meter||!B.rate)return void U({title:"กรุณากรอกข้อมูลให้ครบทุกช่อง",status:"warning"});try{var e,r;let l=await (0,N.x7)((0,N.H9)(C.db,"rooms",String(t))),a=P;l.exists()&&(a=l.data());let i=(null==(e=F[0])?void 0:e.electricityMeterCurrent)||0,n=(null==(r=F[0])?void 0:r.waterMeterCurrent)||0,s=Number(A.meter)-Number(i),o=Number(A.rate),d=Number(B.meter)-Number(n),c=Number(B.rate),x={roomId:String(t),date:A.date,dueDate:A.dueDate,electricityMeterCurrent:Number(A.meter),electricityMeterPrev:i,electricityRate:o,electricityUnit:s,electricityTotal:s*o,waterMeterCurrent:Number(B.meter),waterMeterPrev:n,waterRate:c,waterUnit:d,waterTotal:d*c,createdAt:new Date,rent:(null==a?void 0:a.rent)||0,service:(null==a?void 0:a.service)||0,extraServices:(null==a?void 0:a.extraServices)||[],tenantName:(null==a?void 0:a.tenantName)||"-"};await (0,N.gS)((0,N.rJ)(C.db,"bills"),x),await (0,N.BN)((0,N.H9)(C.db,"rooms",String(t)),{latestBill:x},{merge:!0}),U({title:"บันทึกข้อมูลสำเร็จ",status:"success"});let h=(0,N.P)((0,N.rJ)(C.db,"bills"),(0,N._M)("roomId","==",String(t)),(0,N.My)("createdAt","desc"),(0,N.AB)(10)),g=(await (0,N.GG)(h)).docs.map(e=>({id:e.id,...e.data()}));M(g)}catch(e){U({title:"บันทึกข้อมูลไม่สำเร็จ",status:"error"})}}},K=async e=>{H(e)},O=async()=>{if(L)try{if(await (0,N.kd)((0,N.H9)(C.db,"bills",L)),U({title:"ลบข้อมูลสำเร็จ",status:"success"}),!t)return;let e=(0,N.P)((0,N.rJ)(C.db,"bills"),(0,N._M)("roomId","==",String(t)),(0,N.My)("createdAt","desc"),(0,N.AB)(10)),r=(await (0,N.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));M(r)}catch(e){U({title:"ลบข้อมูลไม่สำเร็จ",status:"error"})}finally{H(null)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(z.A,{user:{name:"xxx",avatar:"/avatar.png",greeting:"อาทิตย์ 21 มิ.ย. 2568"}}),(0,l.jsxs)(o.a,{minH:"100vh",bgGradient:"linear(to-br, #e3f2fd, #bbdefb)",p:[2,8],color:"gray.800",children:[(0,l.jsxs)(d.s,{align:"center",mb:8,children:[(0,l.jsx)(c.$,{leftIcon:(0,l.jsx)(I.QVr,{}),variant:"ghost",colorScheme:"blue",borderRadius:"xl",fontFamily:"Kanit",size:"md",onClick:()=>r.back(),children:"กลับหน้าหลัก"}),(0,l.jsxs)(x.D,{fontWeight:"bold",fontSize:["xl","2xl"],color:"blue.700",ml:4,children:["ประวัติค่าไฟ - ห้อง ",t]})]}),P&&(0,l.jsxs)(o.a,{bg:"white",borderRadius:"2xl",boxShadow:"0 2px 16px 0 rgba(33,150,243,0.10)",p:[4,6],mb:6,children:[(0,l.jsx)(h.E,{fontWeight:"bold",fontSize:"lg",color:"blue.700",mb:3,children:"ข้อมูลห้อง"}),(0,l.jsxs)(d.s,{gap:6,flexWrap:"wrap",children:[(0,l.jsxs)(o.a,{children:[(0,l.jsx)(h.E,{color:"gray.600",fontSize:"sm",children:"ชื่อผู้เช่า"}),(0,l.jsx)(h.E,{fontWeight:"semibold",color:"gray.800",children:P.tenantName||"-"})]}),(0,l.jsxs)(o.a,{children:[(0,l.jsx)(h.E,{color:"gray.600",fontSize:"sm",children:"ขนาดห้อง"}),(0,l.jsxs)(h.E,{fontWeight:"semibold",color:"gray.800",children:[P.area||0," ตร.ม."]})]}),(0,l.jsxs)(o.a,{children:[(0,l.jsx)(h.E,{color:"gray.600",fontSize:"sm",children:"สถานะ"}),(0,l.jsx)(h.E,{fontWeight:"semibold",color:"occupied"===P.status?"green.600":"gray.600",children:"occupied"===P.status?"มีคนอยู่":"ว่าง"})]}),(0,l.jsxs)(o.a,{children:[(0,l.jsx)(h.E,{color:"gray.600",fontSize:"sm",children:"ค่าเช่า"}),(0,l.jsxs)(h.E,{fontWeight:"semibold",color:"gray.800",children:["฿",(null==(e=P.rent)?void 0:e.toLocaleString("th-TH"))||0]})]})]})]}),(0,l.jsxs)(d.s,{gap:6,flexWrap:"wrap",mb:8,children:[(0,l.jsxs)(o.a,{flex:1,minW:"320px",bg:"white",borderRadius:"2xl",boxShadow:"0 2px 16px 0 rgba(33,150,243,0.10)",p:[4,6],children:[(0,l.jsxs)(d.s,{align:"center",mb:4,gap:2,children:[(0,l.jsx)(g.I,{as:I.lHQ,color:"yellow.400",boxSize:6}),(0,l.jsx)(h.E,{fontWeight:"bold",fontSize:"lg",color:"blue.700",children:"บันทึกค่าไฟฟ้ารอบใหม่"})]}),(0,l.jsxs)(d.s,{gap:3,mb:4,children:[(0,l.jsxs)(o.a,{flex:1,minW:"120px",children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"วันที่จด"}),(0,l.jsx)(u.p,{type:"date",value:A.date,onChange:e=>D({...A,date:e.target.value}),size:"lg",bg:"gray.50"})]}),(0,l.jsxs)(o.a,{flex:1,minW:"120px",children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"วันครบกำหนด"}),(0,l.jsx)(u.p,{type:"date",value:A.dueDate,onChange:e=>D({...A,dueDate:e.target.value}),size:"lg",bg:"gray.50"})]})]}),(0,l.jsxs)(o.a,{mb:3,children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"เลขมิเตอร์ปัจจุบัน"}),(0,l.jsxs)(b.M,{children:[(0,l.jsx)(m.W,{pointerEvents:"none",children:(0,l.jsx)(I.lHQ,{color:"#fbbf24"})}),(0,l.jsx)(u.p,{placeholder:"เลขมิเตอร์",value:A.meter,onChange:e=>D({...A,meter:e.target.value}),size:"lg",bg:"gray.50"})]})]}),(0,l.jsxs)(o.a,{mb:3,children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"ค่ามิเตอร์ครั้งก่อน"}),(0,l.jsx)(u.p,{value:A.prev,isReadOnly:!0,size:"lg",bg:"gray.100",color:"gray.500"}),(0,l.jsx)(h.E,{fontSize:"xs",color:"gray.400",mt:1,children:P?"จากข้อมูลห้อง":F.length>0?"จากประวัติล่าสุด":"ไม่มีข้อมูล"})]}),(0,l.jsxs)(o.a,{mb:3,children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"เรทค่าไฟ (บาท/หน่วย)"}),(0,l.jsx)(u.p,{placeholder:"เช่น 4.5",value:A.rate,onChange:e=>D({...A,rate:e.target.value}),size:"lg",bg:"gray.50",type:"number",min:"0",step:"0.01"}),(0,l.jsx)(h.E,{fontSize:"xs",color:"gray.400",mt:1,children:F.length>0?"จากประวัติล่าสุด":"ค่าเริ่มต้น"})]})]}),(0,l.jsxs)(o.a,{flex:1,minW:"320px",bg:"white",borderRadius:"2xl",boxShadow:"0 2px 16px 0 rgba(33,150,243,0.10)",p:[4,6],children:[(0,l.jsxs)(d.s,{align:"center",mb:4,gap:2,children:[(0,l.jsx)(g.I,{as:I.DFS,color:"blue.400",boxSize:6}),(0,l.jsx)(h.E,{fontWeight:"bold",fontSize:"lg",color:"blue.700",children:"บันทึกค่าน้ำรอบใหม่"})]}),(0,l.jsxs)(o.a,{mb:3,children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"เลขมิเตอร์น้ำปัจจุบัน"}),(0,l.jsxs)(b.M,{children:[(0,l.jsx)(m.W,{pointerEvents:"none",children:(0,l.jsx)(I.DFS,{color:"#38bdf8"})}),(0,l.jsx)(u.p,{placeholder:"เลขมิเตอร์น้ำ",value:B.meter,onChange:e=>W({...B,meter:e.target.value}),size:"lg",bg:"gray.50"})]})]}),(0,l.jsxs)(o.a,{mb:3,children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"ค่ามิเตอร์น้ำครั้งก่อน"}),(0,l.jsx)(u.p,{value:B.prev,isReadOnly:!0,size:"lg",bg:"gray.100",color:"gray.500"}),(0,l.jsx)(h.E,{fontSize:"xs",color:"gray.400",mt:1,children:P?"จากข้อมูลห้อง":F.length>0?"จากประวัติล่าสุด":"ไม่มีข้อมูล"})]}),(0,l.jsxs)(o.a,{mb:3,children:[(0,l.jsx)(h.E,{mb:1,color:"gray.600",children:"เรทค่าน้ำ (บาท/หน่วย)"}),(0,l.jsx)(u.p,{placeholder:"เช่น 15.5",value:B.rate,onChange:e=>W({...B,rate:e.target.value}),size:"lg",bg:"gray.50",type:"number",min:"0",step:"0.01"}),(0,l.jsx)(h.E,{fontSize:"xs",color:"gray.400",mt:1,children:F.length>0?"จากประวัติล่าสุด":"ค่าเริ่มต้น"})]})]})]}),(0,l.jsx)(d.s,{justify:"flex-end",mb:8,children:(0,l.jsx)(c.$,{leftIcon:(0,l.jsx)(I.Ani,{}),colorScheme:"blue",size:"md",borderRadius:"xl",fontFamily:"Kanit",fontWeight:"bold",px:6,onClick:X,children:"บันทึกข้อมูล"})}),(0,l.jsxs)(o.a,{bg:"white",borderRadius:"2xl",boxShadow:"0 2px 16px 0 rgba(33,150,243,0.10)",p:[4,6],children:[(0,l.jsx)(h.E,{fontWeight:"bold",fontSize:"lg",color:"blue.700",mb:4,children:"ประวัติการคำนวณ"}),(0,l.jsxs)(j.X,{size:"md",variant:"simple",children:[(0,l.jsx)(p.d,{bg:"gray.50",children:(0,l.jsxs)(f.Tr,{children:[(0,l.jsx)(y.Th,{children:"วันที่"}),(0,l.jsx)(y.Th,{color:"orange.400",children:"หน่วยไฟ"}),(0,l.jsx)(y.Th,{children:"เรทไฟ"}),(0,l.jsx)(y.Th,{color:"green.400",children:"ค่าไฟห้อง"}),(0,l.jsx)(y.Th,{children:"หน่วยน้ำ"}),(0,l.jsx)(y.Th,{children:"เรทน้ำ"}),(0,l.jsx)(y.Th,{color:"blue.400",children:"ค่าน้ำห้อง"}),(0,l.jsx)(y.Th,{children:"การดำเนินการ"})]})}),(0,l.jsx)(v.N,{children:F.map((e,r)=>(0,l.jsxs)(f.Tr,{children:[(0,l.jsx)(S.Td,{children:e.date}),(0,l.jsx)(S.Td,{color:"orange.400",children:e.electricityUnit}),(0,l.jsx)(S.Td,{children:e.electricityRate?e.electricityRate:"-"}),(0,l.jsx)(S.Td,{color:"green.400",children:"number"==typeof e.electricityTotal?e.electricityTotal.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2}):"-"}),(0,l.jsx)(S.Td,{children:e.waterUnit}),(0,l.jsx)(S.Td,{children:e.waterRate?e.waterRate:"-"}),(0,l.jsx)(S.Td,{color:"blue.400",children:"number"==typeof e.waterTotal?e.waterTotal.toLocaleString("th-TH",{minimumFractionDigits:2,maximumFractionDigits:2}):"-"}),(0,l.jsx)(S.Td,{children:(0,l.jsx)(c.$,{size:"sm",colorScheme:"red",variant:"ghost",borderRadius:"xl",fontFamily:"Kanit",onClick:()=>K(e.id),leftIcon:(0,l.jsx)(I.qbC,{}),children:"ลบ"})})]},e.id||r))})]})]}),(0,l.jsxs)(E.Lt,{isOpen:!!L,leastDestructiveRef:G,onClose:()=>H(null),children:[(0,l.jsx)(_.m,{}),(0,l.jsxs)(E.EO,{borderRadius:"2xl",children:[(0,l.jsx)(T.r,{fontWeight:"bold",children:"ยืนยันการลบข้อมูล"}),(0,l.jsx)(w.c,{children:"คุณแน่ใจหรือไม่ว่าต้องการลบข้อมูลบิลนี้? การกระทำนี้ไม่สามารถย้อนกลับได้"}),(0,l.jsxs)(R.j,{children:[(0,l.jsx)(c.$,{ref:G,onClick:()=>H(null),borderRadius:"xl",fontFamily:"Kanit",size:"md",children:"ยกเลิก"}),(0,l.jsx)(c.$,{colorScheme:"red",onClick:O,ml:3,borderRadius:"xl",fontFamily:"Kanit",size:"md",children:"ลบ"})]})]})]})]})]})}},3611:(e,r,t)=>{"use strict";t.d(r,{db:()=>x,j:()=>c});var l=t(6042),a=t(9917),i=t(2964),n=t(5226),s=t(5364);let o={apiKey:s.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyDtZQ_gX9xWqGQgxQMBzTH8c9o6t-ZsvKc",authDomain:s.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"raoteebaan.firebaseapp.com",databaseURL:s.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL||"https://raoteebaan-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:s.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"raoteebaan",storageBucket:s.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"raoteebaan.appspot.com",messagingSenderId:s.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"986271509277",appId:s.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:986271509277:web:ff35142f2eabe2063c0ff4",measurementId:s.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-YW7ZP3B4TC"},d=(0,l.Dk)().length?(0,l.Dk)()[0]:(0,l.Wp)(o),c=(0,a.xI)(d),x=(0,i.aU)(d);(0,n.c7)(d)},8466:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/history/[roomId]",function(){return t(3494)}])},8619:(e,r,t)=>{"use strict";t.d(r,{A:()=>b});var l=t(7876),a=t(9803),i=t(1921),n=t(7365),s=t(3782),o=t(9955),d=t(485),c=t(2870),x=t(9099),h=t(4232),g=t(3611),u=t(2964);function b(e){let{user:r}=e,t=(0,x.useRouter)(),[b,m]=(0,h.useState)({name:(null==r?void 0:r.name)||"xxx",avatar:null==r?void 0:r.avatar,greeting:null==r?void 0:r.greeting}),[j,p]=(0,h.useState)(null);return(0,h.useEffect)(()=>{let e=g.j.currentUser;e?(m({name:e.displayName||(null==r?void 0:r.name)||"xxx",avatar:e.photoURL||(null==r?void 0:r.avatar),greeting:new Date().toLocaleString("th-TH",{dateStyle:"full",timeStyle:"short"})}),(0,u.x7)((0,u.H9)(g.db,"users",e.uid)).then(e=>{p(e.exists()?e.data().role:"user")})):(m({name:(null==r?void 0:r.name)||"xxx",avatar:null==r?void 0:r.avatar,greeting:new Date().toLocaleString("th-TH",{dateStyle:"full",timeStyle:"short"})}),p(null))},[r]),(0,l.jsxs)(a.s,{as:"header",w:"full",px:[2,4,8],py:[2,3],align:"center",bg:"whiteAlpha.800",borderRadius:"2xl",boxShadow:"0 4px 24px 0 rgba(33, 150, 243, 0.10)",mt:[2,4],mb:[4,8],maxW:"100vw",minH:"64px",position:"relative",zIndex:10,style:{backdropFilter:"blur(12px)"},border:"1.5px solid #e3f2fd",children:[(0,l.jsx)(i.E,{fontWeight:"extrabold",fontSize:["lg","2xl"],color:"blue.500",mr:6,letterSpacing:1,children:"TeeRao"}),(0,l.jsx)(n.h,{}),(0,l.jsxs)(a.s,{align:"center",gap:3,children:[(0,l.jsx)(s.e,{size:"md",name:b.name||"",src:b.avatar,border:"2.5px solid white",boxShadow:"md",bg:"blue.100",color:"blue.700",cursor:"pointer",onClick:()=>t.push("/profile")}),(0,l.jsxs)(o.a,{textAlign:"left",cursor:"pointer",onClick:()=>t.push("/profile"),children:[(0,l.jsxs)(i.E,{fontWeight:"bold",fontSize:"md",color:"gray.800",children:["สวัสดีคุณ ",b.name||"xxx"]}),(0,l.jsx)(i.E,{fontSize:"xs",color:"gray.400",children:b.greeting||"อาทิตย์ 21 มิ.ย. 2568"})]}),"admin"===j&&(0,l.jsx)(d.K,{"aria-label":"Settings",icon:(0,l.jsx)(c.Pcn,{}),variant:"ghost",fontSize:"xl",color:"blue.500",_hover:{bg:"blue.50",color:"blue.600"},borderRadius:"full",onClick:()=>t.push("/admin-users")}),(0,l.jsx)(d.K,{"aria-label":"Notifications",icon:(0,l.jsx)(c.jNV,{}),variant:"ghost",fontSize:"xl",color:"blue.500",_hover:{bg:"blue.50",color:"blue.600"},borderRadius:"full"})]})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[671,871,465,981,678,636,593,792],()=>r(8466)),_N_E=e.O()}]);