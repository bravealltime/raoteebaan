"use strict";(()=>{var e={};e.id=561,e.ids=[561],e.modules={3480:(e,r,t)=>{e.exports=t(5600)},3811:(e,r,t)=>{t.r(r),t.d(r,{config:()=>c,default:()=>l,routeModule:()=>p});var a={};t.r(a),t.d(a,{default:()=>d});var s=t(3480),i=t(8667),n=t(6435);let o=require("firebase-admin");var u=t.n(o);async function d(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{name:t,email:a,role:s,status:i}=e.body;if(!t||!a||!s)return r.status(400).json({error:"Missing required fields"});let n=await u().auth().createUser({email:a,password:Math.random().toString(36).slice(-12)+Math.random().toString(36).slice(-12),displayName:t,emailVerified:!1});await u().firestore().collection("users").doc(n.uid).set({name:t,email:a,role:s,status:i||"active",avatar:"",createdAt:u().firestore.FieldValue.serverTimestamp(),uid:n.uid});let o=await u().auth().generatePasswordResetLink(a,{url:"http://localhost:3000/reset-password"});r.status(200).json({success:!0,message:"User created successfully",resetLink:o,user:{uid:n.uid,email:n.email,name:n.displayName}})}catch(e){if(console.error("Error creating user:",e),"auth/email-already-exists"===e.code)return r.status(400).json({error:"อีเมลนี้มีผู้ใช้งานแล้ว"});r.status(500).json({error:"เกิดข้อผิดพลาดในการสร้างผู้ใช้"})}}u().apps.length||u().initializeApp({credential:u().credential.cert({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g,"\n")})});let l=(0,n.M)(a,"default"),c=(0,n.M)(a,"config"),p=new s.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/create-user",pathname:"/api/create-user",bundlePath:"",filename:""},userland:a})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=3811);module.exports=t})();